<!DOCTYPE html>
<html lang="en">
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <base target="_top">
  <link rel="shortcut icon" href="https://www.gstatic.com/images/branding/product/1x/sheets_2020q4_48dp.png" type="image/x-icon">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- SWAL2 -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css" />
  <title>Careleavers Details</title>
</head>
<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
      <a class="navbar-brand" href="#" onclick="event.preventDefault();">Careleavers Details</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" id="a-entry" href="#" onclick="event.preventDefault(); showTab('entry')">Data Entry</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="a-view" href="#" onclick="event.preventDefault(); showTab('view')">View Data</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <div class="container mt-4">
    <!-- Data Entry Tab -->
    <div id="entry" class="tab-content">
      <h2 class="my-4">Data Entry Form</h2>
      <form id="dataForm" onsubmit="event.preventDefault(); saveFormData();">
        <div class="mb-3">
          <label for="district" class="form-label">District</label>
          <select class="form-select" id="district" name="district" onchange="loadCCIs()" required>
            <option value="">Select District</option>
            {% for district in districts %}
              <option value="{{ district }}">{{ district }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="mb-3">
          <label for="cci" class="form-label">CCI Name</label>
          <select class="form-select" id="cci" name="cci" required>
            <option value="">Select CCI</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="child-name" class="form-label">Name of the Child</label>
          <input type="text" class="form-control" id="child-name" name="child-name" required>
        </div>
        <div class="mb-3">
          <label for="dob" class="form-label">Date of Birth</label>
          <input type="date" class="form-control" id="dob-dt" name="dob" required>
        </div>
        <div class="mb-3">
          <label for="gender" class="form-label">Gender</label>
          <select class="form-select" id="gender" name="gender" required>
            <option value="">Select Gender</option>
            <option value="Male">Male</option>
            <option value="Female">Female</option>
            <option value="Other">Other</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="category" class="form-label">Category</label>
          <select class="form-select" id="category" name="category" required>
            <option value="">Select Category</option>
            <option value="CNCP-non CWSN">CNCP-non CWSN</option>
            <option value="CNCP-CWSN">CNCP-CWSN</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="authority-name" id="authority-label" class="form-label">Name of the CWC</label>
          <select class="form-select" id="authority-name" name="authority-name" required>
            <option value="">Select CWC</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="release-dt" class="form-label">Date of Release from CCI</label>
          <input type="date" class="form-control" id="release-dt" name="release-dt" required>
        </div>
        <div class="mb-3">
          <label class="control-label">Was SIR Done?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="is-sir-done-yes" name="is-sir-done" value="Yes">
            <label class="form-check-label" for="is-sir-done-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="is-sir-done-no" name="is-sir-done" value="No" checked>
            <label class="form-check-label" for="is-sir-done-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Was received any Aftercare Training from CCI?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="is-aftercare-trained-yes" name="is-aftercare-trained" value="Yes">
            <label class="form-check-label" for="is-aftercare-training-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="is-aftercare-trained-no" name="is-aftercare-trained" value="No" checked>
            <label class="form-check-label" for="is-aftercare-training-no">No</label>
          </div>
        </div>
        <div id="aftercare-training" style="display: none;">
        <div class="mb-3">
          <label for="aftercare-details" class="form-label">Details of Aftercare Training</label>
          <input type="text" class="form-control" id="aftercare-details" name="aftercare-details">
        </div>
        </div>
        <div class="mb-3">
          <label for="phone-number" class="form-label">Present Phone Number</label>
          <input type="tel" class="form-control" id="phone-number" name="phone-number">
        </div>
        <div class="mb-3">
          <label for="address" class="form-label">Present Address</label>
          <textarea class="form-control" id="address" name="address" rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label for="family-bg" class="form-label">Family Background</label>
          <select class="form-select" id="family-bg" name="family-bg" required>
            <option value="">Select one</option>
            <option value="Single Parents">Single Parents</option>
            <option value="Orphan">Orphan</option>
            <option value="Both Parents">Both Parents</option>
            <option value="Others">Other Relatives</option>
          </select>
        </div>
        <div class="mb-3">
          <label for="support-req" class="form-label">Are you looking for any support?</label>
          <input type="text" class="form-control" id="support-req" name="support-req" alt="Please specify" required>
        </div>
        <div class="mb-3">
          <label for="highest-education" class="form-label">Highest Educational Qualification</label>
          <select class="form-select" id="highest-education" name="highest-education" required>
            <option value="">Select one</option>
            <option value="Below 10th/ Madhyamik">Below 10th/ Madhyamik</option>
            <option value="10th/ Madhyamik">10th/ Madhyamik</option>
            <option value="12th/ HS">12th/ HS</option>
            <option value="Diploma/ ITI">Diploma/ ITI</option>
            <option value="Graduate">Graduate</option>
            <option value="Post Graduate">Post Graduate</option>
          </select>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have a laptop/ desktop for work?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-laptop-yes" name="has-laptop" value="Yes">
            <label class="form-check-label" for="has-laptop-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-laptop-no" name="has-laptop" value="No" checked>
            <label class="form-check-label" for="has-laptop-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have Birth Certificate?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-birth-cert-yes" name="has-birth-cert" value="Yes">
            <label class="form-check-label" for="has-birth-cert-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-birth-cert-no" name="has-birth-cert" value="No" checked>
            <label class="form-check-label" for="has-birth-cert-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have Caste Certificate?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-caste-cert-yes" name="has-caste-cert" value="Yes">
            <label class="form-check-label" for="has-caste-cert-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-caste-cert-no" name="has-caste-cert" value="No" checked>
            <label class="form-check-label" for="has-caste-cert-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have the release order from CCI?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-release-order-yes" name="has-release-order" value="Yes">
            <label class="form-check-label" for="has-release-order-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-release-order-no" name="has-release-order" value="No" checked>
            <label class="form-check-label" for="has-release-order-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have AADHAAR Card?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-aadhaar-yes" name="has-aadhaar" value="Yes">
            <label class="form-check-label" for="has-aadhaar-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-aadhaar-no" name="has-aadhaar" value="No" checked>
            <label class="form-check-label" for="has-aadhaar-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have PAN Card?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-pan-yes" name="has-pan" value="Yes">
            <label class="form-check-label" for="has-pan-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-pan-no" name="has-pan" value="No" checked>
            <label class="form-check-label" for="has-pan-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have Voter ID Card?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-voter-yes" name="has-voter" value="Yes">
            <label class="form-check-label" for="has-voter-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-voter-no" name="has-voter" value="No" checked>
            <label class="form-check-label" for="has-voter-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have any Bank Account?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-bank-yes" name="has-bank" value="Yes">
            <label class="form-check-label" for="has-bank-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-bank-no" name="has-bank" value="No" checked>
            <label class="form-check-label" for="has-bank-no">No</label>
          </div>
        </div>
        <div class="mb-3">
          <label class="control-label">Do you have Aayushman Bharat Card?</label>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-aayushman-yes" name="has-aayushman" value="Yes">
            <label class="form-check-label" for="has-aayushman-yes">Yes</label>
          </div>
          <div class="form-check form-check-inline">
            <input type="radio" class="form-check-input" id="has-aayushman-no" name="has-aayushman" value="No" checked>
            <label class="form-check-label" for="has-aayushman-no">No</label>
          </div>
        </div>
        <button type="submit" class="btn btn-primary">Submit</button>
      </form>
    </div>

    <!-- View Data Tab -->
    <div id="view" class="tab-content">
      <h2 class="my-4">View Data</h2>
      <div class="row mb-3">
        <div class="col-md-4">
          <label for="filterDistrict" class="form-label">District</label>
          <select class="form-select" id="filterDistrict" onchange="loadFilterCCI();loadFilteredData();">
            <option value="">All Districts</option>
            {% for district in districts %}
            <option value="{{ district }}">{{ district }}</option>
            {% endfor %}
          </select>
        </div>
        <div class="col-md-4">
          <label for="filterCCI" class="form-label">CCI Name</label>
          <select class="form-select" id="filterCCI" onchange="loadFilteredData()">
            <option value="">Select CCI</option>
          </select>
        </div>
      </div>
      <table class="display stripe" id="dataTable" style="width:80%;">
        <thead>
          <tr>
            <th>#</th>
            <th>District</th>
            <th>CCI Name</th>
            <th>Name of the Child</th>
            <th>Gender</th>
            <th>Date of Birth</th>
            <th>Category</th>
            <th>CWC</th>
            <th>Released from CCI</th>
            <th>Is SIR Done?</th>
            <th>Is Aftercare Training Done?</th>
            <th>Trained on</th>
            <th>Pone No.</th>
            <th>Present Address</th>
          </tr>
        </thead>
        <tbody>
          <!-- Data rows will be populated here -->
        </tbody>
      </table>
    </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>
  <script>
    // Show/hide tabs
    function showTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.style.display = 'none';
      });
      document.getElementById(tabName).style.display = 'block';
      if (tabName === 'view') {
        document.getElementById('a-entry').classList.remove('active');
        document.getElementById('a-view').classList.add('active');
        document.getElementById('filterDistrict').selectedIndex = 0;
        loadFilteredData();
      }
      else {
        document.getElementById('a-view').classList.remove('active');
        document.getElementById('a-entry').classList.add('active');
        loadAuthorities();
        setMaxDateInput();
      }
    }

    // Show/hide after care details
    document.getElementById('is-aftercare-trained-yes').addEventListener('change', function() {
      document.getElementById('aftercare-training').style.display = 'block';
      document.getElementById('aftercare-details').setAttribute('required', true);
    });
    document.getElementById('is-aftercare-trained-no').addEventListener('change', function() {
      document.getElementById('aftercare-training').style.display = 'none';
      document.getElementById('aftercare-details').removeAttribute('required');
    });

    // Load Authority Names
    function loadAuthorities() {
      const authoritySelect = document.getElementById('authority-name');
      let authorities = [
        'Alipurduar',
        'Bankura',
        'Birbhum',
        'Cooch Behar',
        'Dakshin Dinajpur',
        'Darjeeling',
        'Hooghly',
        'Howrah',
        'Jalpaiguri',
        'Jhargram',
        'Kalimpong',
        'Kolkata',
        'Malda',
        'Murshidabad',
        'Nadia',
        'North 24 Parganas',
        'Paschim Medinipur',
        'Pascim Bardhaman',
        'Purba Medinipur',
        'Purba Bardhaman',
        'Purulia',
        'South 24 Parganas',
        'Uttar Dinajpur',
        'Siliguri',
        'Sunderban'
      ];
      authorities.sort();
      authorities.forEach(authority => {
        const option = document.createElement('option');
        option.value = authority;
        option.textContent = authority;
        authoritySelect.appendChild(option);
      });
    }

    // Function to set date input max to today
    function setMaxDateInput() {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('admission-dt').setAttribute('max', today);
      document.getElementById('placement-order-dt').setAttribute('max', today);
      document.getElementById('sir-order-dt').setAttribute('max', today);
    }

    // Load Districts
    fetch('/get_districts')
     .then(response => response.json())

    function loadCCIs() {
      const district = document.getElementById('district').value;
      if (!district) return;
      fetch('/get_ccis', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ district: district })
      })
      .then(response => response.json())
      .then(data => {
        const cciSelect = document.getElementById('cci');
        cciSelect.innerHTML = '<option value="">Select CCI</option>';
        data.forEach(cci => {
          const option = document.createElement('option');
          option.value = cci[0];
          option.textContent = cci[1];
          cciSelect.appendChild(option);
        });
      });
    }

    function loadFilterCCI() {
      const district = document.getElementById('filterDistrict').value;
      if (!district) {
        document.getElementById('filterCCI').innerHTML = '<option value="">Select CCI</option>';
        return;
      }
      fetch('/get_ccis', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ district: district })
      })
      .then(response => response.json())
      .then(data => {
        const cciSelect = document.getElementById('filterCCI');
        cciSelect.innerHTML = '<option value="">Select CCI</option>';
        data.forEach(cci => {
          const option = document.createElement('option');
          option.value = cci[0];
          option.textContent = cci[1];
          cciSelect.appendChild(option);
        });
      });
    }

    // Save form data
    function saveFormData() {
      const formData = new FormData(document.getElementById('dataForm'));
      const data = Object.fromEntries(formData.entries());

      fetch('/submit', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(result => {
        if (result.status) {
          Swal.fire({
            icon: 'success',
            title: 'Success!',
            text: result.message,
          });
          document.getElementById('dataForm').reset();
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error!',
            text: result.message,
          });
        }
      })
      .catch(error => {
        Swal.fire({
          icon: 'error',
          title: 'Error!',
          text: 'An error occurred while saving the data.',
        });
      });
    }

    // Load filtered data for viewing
    function loadFilteredData() {
      // Destroy existing DataTable instance
      if ($.fn.DataTable.isDataTable('#dataTable')) {
        $('#dataTable').DataTable().destroy();
      }
      const district = document.getElementById('filterDistrict').value;
      const cci = document.getElementById('filterCCI').value;
      fetch('/view', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          district: district || '',
          cci: cci || ''
        })
      })
      .then(response => response.json())
      .then(data => {
        const tbody = document.querySelector('#dataTable tbody');
        tbody.innerHTML = ''; // Clear existing rows

        data.forEach(row => {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${row.sl_no}</td>
            <td>${row.district}</td>
            <td>${row.cci}</td>
            <td>${row.child_name}</td>
            <td>${row.gender}</td>
            <td>${row.dob}</td>
            <td>${row.category}</td>
            <td>${row.cwc_name}</td>
            <td>${row.release_dt}</td>
            <td>${row.is_sir_done}</td>
            <td>${row.is_aftercare_trained}</td>
            <td>${row.aftercare_training}</td>
            <td>${row.phone_no}</td>
            <td>${row.address}</td>
          `;
          tbody.appendChild(tr);
        });

        // Initialize DataTable
        $('#dataTable').DataTable({
          responsive: true,
          scrollX: true
        });
      })
      .catch(error => {
        console.error('Error loading data:', error);
      });
    }

    // Initialize the page
    window.onload = () => {
      showTab('entry');
    };
  </script>
</body>
</html>